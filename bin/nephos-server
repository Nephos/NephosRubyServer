#!/usr/bin/env ruby

require 'optparse'

OptionParser.new do |opts|
  opts.banner = "Usage: nephos-server [-p=port] [--debug]"

  $server_port = ENV["SERVER_PORT"] || 8080
  opts.on("-p=nb", "--port=nb", "Port") do |port|
    $server_port = Integer(port)
  end

  opts.on("--debug") do
    $debug = true
  end

end.parse!

if $debug
  require_relative "../lib/nephos-server"
else
  require 'nephos-server'
end

if not $debug and
  (not File.exists? "Gemfile.lock" or
   not File.read("Gemfile.lock").split.index("nephos-server"))
  raise InvalidApplicationError
end

Nephos::Server.start($server_port)
